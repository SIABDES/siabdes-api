// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "bumdes"]
}

// Auth Schema
model AuthUser {
  id String @id @default(cuid())

  identifier String       @unique
  password   String
  role       AuthUserRole

  bumdes     Bumdes?
  bumdesUnit BumdesUnit?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@map("users")
  @@schema("auth")
}

enum AuthUserRole {
  UNIT
  BUMDES
  KECAMATAN
  KABUPATEN

  @@map("users_role")
  @@schema("auth")
}

// Bumdes Schema
model Bumdes {
  id String @id @default(cuid())

  name  String
  phone String

  completeAddress String?
  province        String
  regency         String
  district        String
  village         String
  postalCode      String

  user   AuthUser @relation(fields: [userId], references: [id])
  userId String   @unique

  units BumdesUnit[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@map("bumdes")
  @@schema("bumdes")
}

model BumdesUnit {
  id String @id @default(cuid())

  name         String
  businessType BumdesUnitBusinessType

  bumdes   Bumdes? @relation(fields: [bumdesId], references: [id])
  bumdesId String?

  user   AuthUser @relation(fields: [userId], references: [id])
  userId String   @unique

  @@map("bumdes_unit")
  @@schema("bumdes")
}

enum BumdesUnitBusinessType {
  JASA
  DAGANG
  INDUSTRI

  @@schema("bumdes")
}
